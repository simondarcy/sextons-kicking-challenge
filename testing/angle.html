<!DOCTYPE HTML>
<html>
<head>
    <title>Tanks - Part 1</title>
    <meta charset="utf-8">
    <script src="../assets/js/phaser.min.js"></script>
</head>
<body>

    <div id="game"></div>

    <script type="text/javascript">

        var w = Math.max (document.documentElement.clientWidth, window.innerWidth || 0);
        var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

        var game = new Phaser.Game(w, h, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update, render: render });

        var line1;
        var dragStart = false;

        function preload() {
            game.load.image('arrow', 'arrow.png');
            game.load.image('ball', '../assets/img/ball.png');
        }

        var sprite;

        function create() {
            game.physics.startSystem(Phaser.Physics.ARCADE);
        }
        function createBall(){
            ball = game.add.sprite(sprite.x, sprite.y, 'ball');
            ball.scale.set(0.5);
            game.physics.arcade.enable(ball);
            ball.body.bounce.set(0.8);
            ball.body.velocity.set(0, 200);
        }
        function removeArrow(){
            sprite.destroy();
        }
        function createArrow(){
            sprite = game.add.sprite(game.width/2, game.height/2, 'arrow');
            sprite.anchor.setTo(0.5);
            sprite.scale.setTo(0.5);
            sprite.scale.x *= -1;
            line1 = new Phaser.Line(0, 0, 0, 0);
        }

        function distance(x1, y1, x2, y2) {
            var dx = x1 - x2;
            var dy = y1 - y2;
            return Math.sqrt(dx * dx + dy * dy);
        }

        function update() {

            if (this.game.input.activePointer.isDown) {
                if(!dragStart){
                    createArrow();
                    dragStart = true;
                }
                sprite.rotation = game.physics.arcade.angleToPointer(sprite);
                line1.fromSprite(sprite, this.game.input.activePointer, false);

            }


            if (this.game.input.activePointer.isUp && dragStart){

                dragStart = false;
                line1 = new Phaser.Line(0, 0, 0, 0);
                removeArrow();
                createBall();
                dis = Math.round(distance(sprite.x, sprite.y, this.game.input.activePointer.x, this.game.input.activePointer.y) );
                game.physics.arcade.velocityFromRotation(sprite.rotation, -dis*1.5, ball.body.velocity);

            }


        }

        function render() {
            game.debug.geom(line1, '#FFFFFF');
        }


    </script>

</body>
</html>